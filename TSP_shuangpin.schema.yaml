# Rime schema
# encoding: utf-8

schema:
  schema_id: TSP_shuangpin
  name: TSP双拼
  version: "0.1"
  author:
    - Tastror
  description: |
    TSP 双拼方案
  dependencies:
    - stroke

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - reverse_lookup_translator
    - script_translator
  filters:
    - uniquifier
    # - simplifier

# 将【查询串】转为【输入串】
speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba
  delimiter: " '"
  algebra:
    # 原来码表中有xx作为不明的字
    - erase/^xx$/
    # ju与jv均合法
    - derive/^([jqxy])u$/$1v/
    # 声母
    - xform/^zh/A/
    - xform/^ch/V/
    - xform/^sh/E/
    # 零声母
    - xform/^([aoe].*)$/O$1/
    # 韵母
    ### ~a
    - xform/[iu]a$/Q/  # ia, ua --> Q
    # seems nothing  # a --> A
    ### ~ai
    - xform/ing$|uai$/L/  # ing, uai --> L
    - xform/ai$/Z/  # ai --> Z
    ### ~au
    - xform/iao$/B/  # iau --> B
    - xform/ao$/W/  # au --> W
    ### ~an, ên, aên
    - xform/uan$/G/  # uan, üaên --> G
    - xform/ian$/R/  # iên --> R
    - xform/an$/F/  # an, ên --> F
    ### ~ang
    - xform/[iu]ang$/S/  # iang, uang --> S
    - xform/ang$/D/  # ang --> D
    ### ~o
    - xform/uo$/O/  # o, uo --> O
    ### ~ou
    - xform/er$|iu$/N/  # iou, er --> N
    - xform/ou$/M/  # ou --> M
    ### ~ong
    - xform/i?ong$/T/  # iong, ong --> T
    ### ~e
    # seems nothing  # e, ê --> E
    ### ~en
    - xform/un$/P/  # üin, uen --> P
    - xform/en$/J/  # en --> J
    ### ~eng
    - xform/eng$/K/  # eng --> K
    ### ~ê
    - xform/ie$/C/  # iê --> C
    - xform/[uv]e$/X/  # üê --> X
    # (ê see e)
    ### ~êi
    - xform/ui$/V/  # ü, uêi --> V
    - xform/ei$/Y/  # êi --> Y
    ### ~i, ɿ, ʅ
    # seems nothing  # i, ɿ, ʅ --> I
    ### ~in
    # (üin see uen)
    - xform/in$/H/  # in --> H
    ### ~ing
    # (ing see uai)
    ### ~u
    # seems nothing  # u --> U
    ### ~ü
    # (v see uêi)
    ### ~er
    # (er see iou)
    # 转小写
    - xlit/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/

# 将【输入串】转为【可视串】
translator:
  dictionary: TSP_shuangpin
  preedit_format:
    # 转大写，防止后面出现两次转码的情况
    - xlit/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/
    # 声母
    - "xform/(^|[ '])A/$1zh/"
    - "xform/(^|[ '])V/$1ch/"
    - "xform/(^|[ '])E/$1sh/"
    # 韵母
    # 组一：BPMF
    # 组二：DTNL
    # 组三：GKH ZCS hR
    # 组四：JQX
    # 组五：YW
    # 组六：Y2（撮口呼的Y）
    - xform/([GKHZCShR])Q/$1ua/  # Q --> ua
    - xform/(\w)Q/$1ia/  # Q --> ia
    - xform/(\w)A/$1a/  # A --> a
    ### ~ai
    - xform/([GKHZCShR])L/$1uai/  # L --> uai
    - xform/(\w)L/$1ing/  # L --> ing
    - xform/(\w)Z/$1ai/  # ai --> Z
    ### ~au
    - xform/(\w)B/$1iau/  # B --> iau
    - xform/(\w)W/$1au/  # W --> au
    ### ~an, ên, aên
    - xform/([BPMFDTNLGKHZCShR])G/$1uan/  # G --> uan
    - xform/(\w)G/$1üaên/  # G --> üaên  # !!! 撮口呼的Y
    - xform/(\w)R/$1iên/  # R --> iên
    - xform/(Y)F/$1ên/  # F --> ên
    - xform/(\w)F/$1an/  # F --> an
    ### ~ang
    - xform/([GKHZCShR])S/$1uang/  # S --> uang
    - xform/(\w)S/$1iang/  # S --> iang
    - xform/(\w)D/$1ang/  # D --> ang
    ### ~o
    - xform/([BPMFDTNLGKHZCShR])O/$1uo/  # O --> uo
    - xform/(\w)O/$1o/  # O --> o
    ### ~ou
    - xform/(O)N/$1er/  # N --> er
    - xform/(\w)N/$1iou/  # N --> iou
    - xform/(\w)M/$1ou/  # M --> ou
    ### ~ong
    - xform/([JQX])T/$1iong/  # T --> iong
    - xform/(\w)T/$1ong/  # T --> ong
    ### ~e
    - xform/(Y)E/$1ê/  # E --> ê
    - xform/(\w)E/$1e/  # E --> e
    ### ~en
    - xform/([JQXY])P/$1üin/  # P --> üin  # !!! 撮口呼的Y
    - xform/(\w)P/$1uen/  # P --> uen
    - xform/(\w)J/$1en/  # J --> en
    ### ~eng
    - xform/(\w)K/$1eng/  # K --> eng
    ### ~ê
    - xform/(\w)C/$1iê/  # C --> iê
    - xform/(\w)X/$1üê/  # X --> üê  # !!! 撮口呼的Y
    # (ê see e)
    ### ~êi
    - xform/([NLJQXY])V/$1ü/  # V --> ü  # !!! 撮口呼的Y
    - xform/(\w)V/$1uêi/  # V --> uêi
    - xform/(\w)Y/$1êi/  # Y --> êi
    ### ~i, ɿ, ʅ
    - xform/([ZCS])I/$1ɿ/  # I --> ɿ
    - xform/([hR])I/$1ʅ/  # I --> ʅ
    - xform/(\w)I/$1i/  # I --> i
    ### ~in
    # (üin see uen)
    - xform/(\w)H/$1in/  # H --> in
    ### ~ü
    - xform/([JQXY])U/$1ü/  # some ü are in U, others see V
    # 零声母
    - xform/O(\w)/$1/
    # 小写
    - xlit/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/

reverse_lookup:
  dictionary: stroke
  enable_completion: true
  prefix: "u"
  suffix: "'"
  tips: 〔笔画〕Ｈ一　Ｓ丨　Ｐ丿　Ｎ丶　Ｚ乙
  preedit_format:
    - xlit/hspnz/一丨丿丶乙/
  allow_erase_comment: true
  comment_format:
    - xform/^(\w)ao$/$1au/
    - xform/^([jqxy])uan$/$1üaên/
    - xform/^(\w)ian$/$1iên/
    - xform/^yan$/yên/
    - xform/^([BPMF])o$/$1uo/
    - xform/^(\w)iu$/$1iou/
    - xform/^(\w)un$/$1uen/
    - xform/^ye$/yê/
    - xform/^(\w)ie$/$1iê/
    - xform/^(\w)[uv]e$/$1üê/
    - xform/^(\w)ui$/$1uêi/
    - xform/^(\w)ei$/$1êi/
    - xform/^([jqxy])un$/$1üin/
    - xform/^([zcs])i$/$1ɿ/
    - xform/^([zcs]h|r)i$/$1ʅ/
    - xform/^([nl])v$/$1ü/
    - xform/^([jqxy])u$/$1ü/

punctuator:
  import_preset: symbols
  full_shape:
    "`": "｀"
    "\\" : "、"
    "/" : "／"
    "#" : "＃"
    "@" : "＠"
    "*" : "＊"
    "=": "＝"
  half_shape:
    "`": "`"
    "\\" : "、"
    "/" : "/"
    "#" : "#"
    "@" : "@"
    "*" : "*"
    "=": "="
    
key_binder:
  import_preset: default

recognizer:
  import_preset: default
  patterns:
    punct: '^/([0-9]0?|[A-Za-z]+)$'
    reverse_lookup: "u[a-z]*'?$"
